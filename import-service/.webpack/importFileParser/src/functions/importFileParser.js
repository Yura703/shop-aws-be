(()=>{"use strict";var e={596:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.main=t.importFileParser=void 0;const s=r(444),i=o(r(336)),n=o(r(280)),a=[];let d="";t.importFileParser=async e=>{const t=new i.default.S3({region:"eu-west-1"}),r=new i.default.SQS;if(!e.Records)return{statusCode:404};for(let o of e.Records){const e=o.s3.object.key;d=o.s3.bucket.name;const s={Bucket:d,Key:e};await new Promise(((o,i)=>{t.getObject(s).createReadStream().pipe((0,n.default)(["title","description","price","count","imageId"])).on("data",(e=>{r.sendMessage({QueueUrl:process.env.SQS_URL,MessageBody:JSON.stringify(e)},(()=>{console.log("Send message - "+e)}))})).on("end",(async()=>{console.log(JSON.stringify(a)),await t.copyObject({Bucket:d,Key:e.replace("uploaded","parsed"),CopySource:d+"/"+e}).promise(),await t.deleteObject({Bucket:d,Key:e}).promise(),o("OK")}))}))}return{statusCode:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0,"Access-Control-Allow-Methods":"GET, PUT, POST, DELETE","Access-Control-Expose-Headers":"*",Allow:"GET, PUT, POST, DELETE"},body:JSON.stringify(a)}},t.main=(0,s.middyfy)(t.importFileParser)},444:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.middyfy=void 0;const s=o(r(862)),i=o(r(582));t.middyfy=e=>(0,s.default)(e).use((0,i.default)())},862:e=>{e.exports=require("@middy/core")},582:e=>{e.exports=require("@middy/http-json-body-parser")},336:e=>{e.exports=require("aws-sdk")},280:e=>{e.exports=require("csv-parser")}},t={};!function r(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}(596)})();